import:
    - https://tangrams.github.io/blocks/geometry/matrices.yaml
scene:
    background:
        color: grey
cameras:
    camera1:
        type: perspective
        focal_length: 2
styles:
    tilt:
        base: lines
        mix: geometry-matrices
        shaders:
            defines:
                PI: 3.1415926535897932384626433832795
                HALF_PI: 1.5707963267948966192313216916398
            uniforms:
                u_offset: [0,0]
                u_tilt_x: 0.1
                u_tilt_z: 0.1
            blocks:
                position: |
                    position.xyz = rotateX3D(cos(u_offset.x)*u_tilt_x) * rotateZ3D(cos(u_offset.y)*u_tilt_z) * position.xyz;
                    position.x -= u_offset.x;
                    position.y -= u_offset.y;
    lin:
        mix: tilt
    poly:
        mix: tilt
        base: polygons
    walls:
        mix: poly
        blend: overlay
        shaders:
            blocks:
                color: |
                    color = vec4(0, 1, 0, 0.5);

sources:
    osm:
        type: TopoJSON
        url:  //vector.mapzen.com/osm/all/{z}/{x}/{y}.topojson?api_key=vector-tiles-JUsa0Gc
    subway:
        type: GeoJSON
        url: subway.geojson

layers:
    subway:
      data: { source: subway }
      draw:
        railway:
          style: lin
          order: function() { return  feature.layer; }
          color: function() { return feature.colour; }
          width: 8
          z: function() { return  feature.layer * 10; }
    roads:
      data: { source: osm }
      streets:
        filter:
            not: { kind: ["path", "rail"] }
        draw:
            roads:
                style: lin
                order: function() { return  (feature.layer || 0)+ 1; }
                color: [0.4, 0.4, 0.4]
                width: 8
            outline:
                style: lin
                order: function() { return  feature.layer; }
                color: [0.6, 0.6, 0.6]
                width: 10
    water:
        data: { source: osm }
        draw:
            water:
                style: poly
                order: 1
                color: [0.2, 0.2, 0.5]
            outline:
                order: 2
                style: lin
                color: [0.3, 0.3, 0.6]
                width: 2px
                tile_edges: false
    buildings:
        data: { source: osm }
        extruded:
            filter: { $zoom: { min: 13 } }
            draw:
                walls:
                    extrude: true
                walls-outline:
                    style: lin
                    order: 7
                    width: 1
                    extrude: true
                    color: [0.654,0.897,1.000]
                walls-inline:
                    style: lin
                    order: 6
                    width: 1
                    color: [0.654,0.897,1.000]
