import:
    - tilt.yaml
    - roads.yaml
    - landuse.yaml
    - https://tangrams.github.io/blocks/geometry/normal.yaml
global:
    order: function() { return feature.sort_key || 0; }
    rail_order: function() { if($zoom < 15) {return 1000;} else {return feature.sort_key;}}
scene:
    background:
        color: white
cameras:
    camera1:
        type: perspective
        focal_length: 2
styles:
    lin:
        mix: tilt
    poly:
        mix: tilt
        base: polygons
    walls:
        mix: [poly, geometry-normal]
        blend: inlay
        shaders:
            blocks:
                color: |
                    if (isWall()) {
                        color = vec4(0.6, 0.6, 0.6, 0.5);
                    } else {
                        color = vec4(0.7, 0.7, 0.7, 0.2);
                    }

sources:
    osm:
        type: TopoJSON
        url:  //vector.mapzen.com/osm/all/{z}/{x}/{y}.topojson?api_key=vector-tiles-JUsa0Gc
    rail:
        type: GeoJSON
        url: subway.geojson
    station:
        type: GeoJSON
        url: areas.geojson
layers:
    rail:
      data: { source: rail }
      draw:
          rail:
              order: global.rail_order
              style: lin
              width: 1px
              z: function() { return feature.layer * 10; }
              color: black
      rer:
          filter:  [network: RER]
          draw:
              rail:
                  color: function() { return feature.colour; }
                  width: [[10, 3px], [18, 2.8m]]
      transilien:
          filter:  [network: transilien]
          draw:
              rail:
                  color: function() { return feature.colour; }
                  width: [[10, 3px], [18, 2.8m]]
      subway:
          filter:
              route: subway
              $zoom: { min: 12 }
          draw:
              rail:
                  color: function() { return feature.colour; }
                  width: [[10, 2px], [18, 2.4m]]

    station:
        data: { source: station }
        draw:
            polygons:
                style: poly
                color: black
                order: function() { return 10 + feature.layer;}
                z: function() { return  feature.layer * 10; }
                color: function() { return [0, 0, 0, 1 - Math.max(0, $zoom - 17 + feature.layer) / 3.0];}
        corridor:
            filter: { buildingpart: corridor }
            draw:
                polygons:
                    color: function() { return [0, 0, 1, 1 - Math.max(0, $zoom - 17 + feature.layer) / 3.0];}
        vertical:
            filter: { buildingpart: verticalpassage }
            draw:
                polygons:
                    color: function() {console.log($zoom) ;return [0, 1, 1, 1 - Math.max(0, $zoom - 17 + feature.layer) / 3.0];}
                    z: function() { return (feature.layer - 1) * 10}
        room:
            filter: { buildingpart: room }
            draw:
                polygons:
                    style: lin
                    width: 3px
                    z: function() { return feature.layer * 10 - 1; }
                    color: function() { return [0, 0, 0, 1 - Math.max(0, $zoom - 17 + feature.layer) / 3.0];}
    buildings:
        data: { source: osm }
        filter: { $zoom: { min: 13 } }
        draw:
            walls:
                extrude: true
            outline:
                order: global.order
                extrude: true
                style: lin
                color: black
                width: 0.5px
